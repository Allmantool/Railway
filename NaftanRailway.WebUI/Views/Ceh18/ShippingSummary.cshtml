@model NaftanRailway.Domain.BusinessModels.BussinesLogic.Shipping
@{
    Layout = null;
}
<div class="panel panel-default col-lg-12" id="myPanel@(ViewData["index"])">
    <div class="panel-heading small row small">
        <div class="col-lg-2 row">
            <ul class="list-inline text-capitalize">
                <li class="panel-title">
                    @(ViewData["index"]))
                    @if(Model.VOtpr != null){
                        <span class ="@(Model.VOtpr.oper == 1 ? "glyphicon glyphicon-road" : "glyphicon glyphicon-home")"></span>  
                        <a href="#@(ViewData["index"])" data-toggle="collapse">@Model.VOtpr.n_otpr</a>
                    } else {
                        <span class="glyphicon glyphicon-usd"></span>
                        <a href="#@(ViewData["index"])" data-toggle="collapse">Доп. сбор</a>
                    }
                </li>
            </ul>
        </div>
        <div class="col-lg-9 row">
            <ul class="list-inline text-center">
               @if (Model.VOtpr != null){
                   <li><strong>От:</strong> @Model.VOtpr.adr_otpr @Model.VOtpr.nam_otpr</li>
                   <li><span class="glyphicon glyphicon-arrow-right"></span></li>
                   <li><strong>Кому:</strong> @Model.VOtpr.adr_pol @Model.VOtpr.nam_pol</li>
                   <li><strong>Груз:</strong> @String.Join(", ", Model.Etsng)<span class="small">(ЕТСНГ: @Model.VOtpr.cod_tvk_etsng)</span></li>
                   <li><strong>Склад:</strong> @Model.Guild18.warehouse</li>
               }
            </ul>
        </div>
        <div class="col-lg-0 text-right pull-right">
            @using (Html.BeginForm("AddRow", "Storage", FormMethod.Post, new {role = "form"})){
                @Html.HiddenFor(x => Model.VOtpr.id)
                @Html.Hidden("returnUrl", Request.Url == null ? "" : Request.Url.PathAndQuery)
                <button type="submit" class="btn btn-sm btn-link btn-default" data-loading-text="Loading..." id="btn@(ViewData["index"])">
                    <span class="glyphicon glyphicon-pencil"></span></button>
            }
            @using (Html.BeginForm("AddRow", "Storage", FormMethod.Post, new { role = "form" })) {
                @Html.HiddenFor(x => Model.VOtpr.id)
                @Html.Hidden("returnUrl", Request.Url == null ? "" : Request.Url.PathAndQuery)
                <button type="submit" class="btn btn-sm btn-link btn-warning" data-loading-text="Loading..." id="btn@(ViewData["index"])">
                    <span class="glyphicon glyphicon-trash"></span>
                </button>
            }
        </div>
    </div>
    <div id="@(ViewData["index"])" class="collapse row">
        <div class="panel-body">
            @if (Model.VOtpr != null){
                <ul class="list-inline text-center small">
                    @if (Model.Vovs.Any()) {
                        <li><strong>Вагон(ы) №:</strong> @String.Join(", ", Model.Vovs)</li>
                    }
                    @if (Model.VPams.Any()) {
                        <li><strong>Ведомости:</strong> @String.Join(", ", Model.VPams.Select(x=>x.nved))</li>
                    }
                    @if (Model.VAkts.Any()) {
                        <li><strong>Акты:</strong> @String.Join(", ", Model.VAkts.Select(x=>x.nakt))</li>
                    }
                    @if (Model.VKarts.Any()) {
                        <li><strong>Накопительные карточки:</strong> @String.Join(", ", Model.VKarts.Select(x => x.num_kart))</li>
                    }
                    @if (Model.KNaftan.Any()) {
                        <li><strong>Перечени:</strong> @String.Join(", ", Model.KNaftan.Select(x => x.NKRT))</li>
                    }
                    @if (Model.VOtpr.g6.Length > 0){
                        <li><strong>Договор:</strong> @Model.VOtpr.g6</li>
                    }
                    @if (Model.VOtpr.g11.Length > 0) {
                        <li><strong>Описание:</strong> @Model.VOtpr.g11</li>
                    }
                </ul>
            }else{
            <div>
                <ul class="list-inline text-center small">
                    @if (Model.VKarts.Any()) {
                        <li><strong>Накопительные карточки:</strong> @String.Join(", ", Model.VKarts.Select(x => x.num_kart))</li>
                    }
                    @if (Model.KNaftan.Any()) {
                        <li><strong>Перечени:</strong> @String.Join(", ", Model.KNaftan.Select(x => x.NKRT))</li>
                    }
                </ul>
            </div>
            }
        </div>
        <div class="panel-footer small">
            <ul class="list-inline">
            @if (Model.VOtpr != null){
                <li class="pull-left">
                    @(Model.VOtpr.oper == 1 ? "Отправка" : "Прибытие")
                    @(Model.VOtpr.date_oper != null ? Model.VOtpr.date_oper.Value.ToString("d MMM yyyy") : "Не указана")
                </li>
                <li class="pull-right">@Model.VOtpr.fio_tk</li>
            }
            </ul>
        </div>
    </div>
</div>